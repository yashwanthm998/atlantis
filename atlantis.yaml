version: 3
 
projects:
  - dir: Project_1
    workflow: Project_1_workflow
 
  - dir: Project_2
    workflow: Project_2_workflow
 
workflows:
  Project_1_workflow:
    plan:
      steps:
        - run: rm -rf .terraform .terraform.lock.hcl
        - run: terraform init -input=false -upgrade
        - run: terraform plan -var="GOOGLE_CREDENTIALS1=$TF_VAR_GOOGLE_CREDENTIALS1" -var-file="terraform.tfvars" -out=tfplan
    apply:
      steps:
        - run: terraform apply tfplan
        - run: ./Project_1
 
  Project_2_workflow:
    plan:
      steps:
        - run: rm -rf .terraform .terraform.lock.hcl
        - run: terraform init -input=false -upgrade
        - run: terraform plan -var="GOOGLE_CREDENTIALS2=$TF_VAR_GOOGLE_CREDENTIALS2" -var-file="terraform.tfvars" -out=tfplan
    apply:
      steps:
        - run: terraform apply tfplan
 